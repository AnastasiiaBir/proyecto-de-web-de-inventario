name: keep-awake

on:
  schedule:
    - cron: '*/5 * * * *' # каждые 5 минут
  workflow_dispatch: {}

env:
  END_DATE: '2025-11-13'

jobs:
  wake:
    runs-on: ubuntu-latest
    steps:
      - name: Проверить срок работы
        run: |
          TODAY=$(date -u +%Y-%m-%d)
          echo "Сегодня: $TODAY"
          if [[ "$TODAY" > "$END_DATE" ]]; then
            echo "⛔ Срок истёк — workflow отключён."
            exit 0
          fi

      - name: Пинг публичного URL (имитация браузера)
        run: |
          PUBLIC_URL="https://proyecto-de-web-de-inventario.onrender.com"
          echo "Ping → $PUBLIC_URL"
          STATUS=$(curl -A "Mozilla/5.0" -s -o /dev/null -w "%{http_code}" "$PUBLIC_URL" || true)
          echo "HTTP статус: $STATUS"
          if [[ "$STATUS" =~ ^2 ]]; then
            echo "✅ Сервер бодрствует"
          else
            echo "⚠️ Сервер ответил не 2xx — $STATUS"
