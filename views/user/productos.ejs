<!-- views/user/productos.ejs -->
 
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Productos</title>
  <link rel="stylesheet" href="/styles.css">
  <style>
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    input[type=number], input[type=text] { width: 120px; }
    button { padding: 6px 12px; }
  </style>
</head>
<body>
  <h1 style="text-align:center;">Productos</h1>

  <!-- Filtros a través de GET -->
  <form method="GET" action="/user/productos" style="text-align:center; margin-bottom:20px;">
    <input type="text" name="nombre" placeholder="Nombre" value="<%= req.query.nombre || '' %>">
    <input type="text" name="marca" placeholder="Marca" value="<%= req.query.marca || '' %>">
    <input type="text" name="categoria" placeholder="Categoría" value="<%= req.query.categoria || '' %>">
    <input type="text" name="proveedor" placeholder="Proveedor" value="<%= req.query.proveedor || '' %>">
    <input type="number" name="precio" placeholder="Precio máximo" value="<%= req.query.precio || '' %>">
    <input type="number" name="costo" placeholder="Costo máximo" value="<%= req.query.costo || '' %>">
    <input type="number" name="stockMin" placeholder="Stock mínimo" value="<%= req.query.stockMin || '' %>">
    <input type="text" name="localizacion" placeholder="Localización" value="<%= req.query.localizacion || '' %>">
    <button type="submit">Filtrar</button>
  </form>

  <!-- Tabla de productos -->
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Marca</th>
        <th>Categoría</th>
        <th>Proveedor</th>
        <th>Precio</th>
        <th>Costo</th>
        <th>Medida</th>
        <th>Stock</th>
        <th>Localización</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <% productos.forEach(p => { %>
      <tr>
        <td><%= p.id %></td>
        <td><%= p.nombre %></td>
        <td><%= p.marca %></td>
        <td><%= p.categoria_nombre || '' %></td>
        <td><%= p.proveedor_nombre || '' %></td>
        <td><%= p.precio %></td>
        <td><%= p.costo %></td>
        <td><%= p.medida || '' %></td>
        <td><%= p.stock === 0 ? 'No hay stock' : p.stock %></td>
        <td><%= p.localizacion_nombre || '' %></td>
        <td>
          <% if(p.stock > 0) { %>
          <form action="/user/pedidos/crear" method="POST" style="display:inline;">
            <input type="hidden" name="productoId" value="<%= p.id %>">
            <input type="number" name="cantidad" value="1" min="1" max="<%= p.stock %>">
            <button type="submit">Agregar al pedido</button>
          </form>
          <% } else { %>
            <span style="color:red;">No disponible</span>
          <% } %>
        </td>
      </tr>
      <% }) %>
      <% if(productos.length === 0) { %>
      <tr>
        <td colspan="11">No se encontraron productos</td>
      </tr>
      <% } %>
    </tbody>
  </table>

  <div style="text-align:center; margin-top:20px;">
    <a href="/user/dashboard">Volver al dashboard</a>
  </div>
</body>
</html>
